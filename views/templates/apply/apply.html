{% extends 'base.html' %}
{% block style %}
<style>
    .info_box {
        padding-top: 1px;
        margin:  0 auto;
        width: 900px;
    }
    .info_minibox1, .info_minibox2 {
        float: left;
        #border: 1px solid red;
        width: 450px;
        height: 400px;
        font-weight: bold;
        padding: 10px;
        margin-top: 30px;
        background-color: white;
        box-shadow: 0 1px 1px 0 black;
        font-size: 12px;
    }
    .clearfix {
        content: "";
        display: block;
        clear: both;
    }
    .btn_box {
        text-align: center;
        padding-top: 10px;
    }
    .applybtn, .rwbtn, .cancelbtn {
        display: inline-block;
        margin-right: 10px;
    }
    .date_all {
        font-size: 14px;
        margin-top: 5px;
        text-align: center;
    }
    .date, .vdate {
        display: inline-block;
    }
</style>


{% endblock %}
{% block main %}
    <main>
    <form name="applyfrm">
        <div class="main_box">
            <div class="info_box">
                <div class="info_minibox1">
                    <div id="name">
                        <div class="col-auto">
                            <label for="name" class="col-form-label">이름</label>
                        </div>
                        <div class="col-auto">
                            <input type="text" id="name" name="name" class="form-control">
                        </div>
                        <div class="col-auto">
                        </div>
                    </div>
                    <div id="phone_number">
                        <div class="col-auto">
                            <label for="phone_number" class="col-form-label">전화번호</label>
                        </div>
                        <div class="col-auto">
                            <input type="text" id="phone_number" name="phone_number" class="form-control">
                        </div>
                        <div class="col-auto">
                        </div>
                    </div>
                    <div id="email">
                        <div class="col-auto">
                            <label for="email" class="col-form-label">이메일</label>
                        </div>
                        <div class="email">
                            <input type="text" id="email" name="email" class="form-control">
                        </div>
                        <div class="col-auto">
                        </div>
                    </div>
                    <div id="company_name">
                        <div class="col-auto">
                            <label for="cname" class="col-form-label">회사이름</label>
                        </div>
                        <div class="col-auto">
                            <input type="text" id="company_name" name="company_name" class="form-control">
                        </div>
                        <div class="col-auto">
                        </div>
                    </div>
                    <div id="job_position">
                        <div class="col-auto">
                            <label for="job_position" class="col-form-label">직급</label>
                            <select class="form-select" name="job_position" aria-label="Default select example">
                                <option selected>직급 선택</option>
                                <option value="1">킹</option>
                                <option value="2">왕</option>
                                <option value="3">짱</option>
                            </select>
                        </div>
                    </div>
                </div>
            </div>
                <div class="info_minibox2">
                    <div id="location">
                        <div class="col-auto">
                            <label for="location" class="col-form-label">방문할 회사</label>
                            <select class="form-select" name="location_id" aria-label="Default select example">
                                {% for location in location_list %}
                                    <option value="{{ location.id }}">{{location.location}}</option>
                                {% endfor %}
                            </select>
                        </div>
                    </div>
                    <div id="department_name">
                        <div class="col-auto">
                            <label for="department_name" class="col-form-label">부서명</label>
                        </div>
                        <div class="col-auto">
                            <input type="text" id="department_name" name="department_name" class="form-control">
                        </div>
                        <div class="col-auto">
                        </div>
                    </div>
                    <div id="employee_id">
                        <div class="col-auto">
                            <label for="employee_id" class="col-form-label">담당자</label>
                            <select class="form-select" name="employee_id">
                                {% for emp in emp_list %}
                                    <option value="{{ emp.id }}">{{emp.name}} {{emp.job_position}}</option>
                                {% endfor %}
                            </select>
                        </div>
                    </div>
                    <div id="purpose">
                        <div class="col-auto">
                            <label for="purpose" class="col-form-label">방문목적</label>
                        </div>
                        <div class="purpose">
                            <input type="text" id="purpose" name="purpose" class="form-control">
                        </div>
                        <div class="col-auto">
                        </div>
                    </div>
                    <div class="date_all">

                        <div class="visit_date">
                            <div class="col-auto">
                                <label for="visit_date" class="col-form-label">방문일자</label>
                                <input type="date" id="visit_date" name="visit_date">
                            </div>
                        </div>
                    </div>

                    <div>
                    <input type="hidden" id="status" name="status" value="N">

                    </div>

                </div>
                </div>
            <div class="clearfix"></div>
            <div class="btn_box">
                <div class="applybtn">
                    <button type="button" name="applybtn" id="applybtn" class="form-control btn btn-light btn-outline-dark btn-lg theme-btn--dark-inverse sqs-button-element--dark" onClick="location.href='/apply/applyok'">방문신청</button>
                </div>
                <div class="rwbtn">
                    <button type="button" name="rwbtn" class="form-control btn btn-light btn-outline-dark btn-lg theme-btn--dark-inverse sqs-button-element--dark" onClick="location.href='/apply'">&nbsp;재작성&nbsp;</button>
                </div>
                <div class="cancelbtn">
                    <button type="button" name="cancelbtn" class="form-control btn btn-light btn-outline-dark btn-lg theme-btn--dark-inverse sqs-button-element--dark" onClick="location.href='/'">방문취소</button>
                </div>
            </div>
        </div>
    </form>
</main>
{% endblock %}
{% block script %}
    <script>

        function validateForm() {
            let applyfrm = document.applyfrm
            let name = applyfrm.name.value;
            let phone_number = applyfrm.phone_number.value;
            let email = applyfrm.email.value;
            let company_name = applyfrm.company_name.value;
            let job_position = applyfrm.job_position.value;
            let location = applyfrm.location.value;
            let department_name = applyfrm.department_name.value;
            let purpose = applyfrm.purpose.value;
            let regdate = applyfrm.regdate.value;
            let visit_date = applyfrm.visit_date.value;

            // 필수 필드 확인
            if (!name) {
                alert('성함을 입력해주세요.');
                applyfrm.name.focus();
                return false;
            }

            if (!phone_number) {
                alert('연락처를 입력해주세요.');
                applyfrm.phone_number.focus();
                return false;
            }

            if (!email) {
                alert('email 를 입력해주세요.');
                applyfrm.email.focus();
                return false;
            }

            if (!company_name) {
                alert('귀사의 이름을 입력해주세요.');
                applyfrm.cname.focus();
                return false;
            }

            if (!job_position) {
                alert('직급을 입력해주세요.');
                applyfrm.rank.focus();
                return false;
            }


            if (!department_name) {
                alert('부서를 입력해주세요.');
                applyfrm.department_name.focus();
                return false;
            }

            if (!location) {
                alert('방문할 회사를 입력해주세요.');
                applyfrm.location.focus();
                return false;
            }

            if (!purpose) {
                alert('방문목적을 입력해주세요.');
                applyfrm.purpose.focus();
                return false;
            }

            // 전화번호 유효성 검사
            let phoneRegex = /^\d{10,11}$/;
            if (!phoneRegex.test(phone_number)) {
                alert('올바른 핸드폰 번호를 입력해주세요.');
                applyfrm.phone_number.focus();
                return false;
            }

            return true;
        }

        function submitFormData() {
            let applyfrm = document.applyfrm;
            let formData = new FormData(applyfrm);
            let jsonData = {};
            console.log(formData)

            formData.forEach(function(val, key) {
                jsonData[key] = val;
            });
            console.log(jsonData)
            let apiUrl = `http://127.0.0.1:8000/apply/applyok`;
            fetch(apiUrl, {
                method: 'POST',
                headers: {
                    'Accept': 'application/json',
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(jsonData)
            })

            console.log(jsonData)

        }
        document.querySelector('#applybtn').addEventListener('click', submitFormData);

        // 오늘 날짜를 가져오는 함수
        function getTodayDateTime() {
            var today = new Date();
            var dd = String(today.getDate()).padStart(2, '0');
            var mm = String(today.getMonth() + 1).padStart(2, '0');
            var yyyy = today.getFullYear();
            var hh = String(today.getHours()).padStart(2, '0');
            var min = String(today.getMinutes()).padStart(2, '0');
            var dateTimeString = yyyy + '-' + mm + '-' + dd;
            console.log(dateTimeString);
            return dateTimeString;
        }

        // input 요소에 오늘 날짜 설정
        document.getElementById('visit_date').value = getTodayDateTime();

    </script>

{% endblock %}
